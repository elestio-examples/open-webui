#set env vars
set -o allexport; source .env; set +o allexport;

#wait until the server is ready
echo "Waiting for software to be ready ..."
sleep 20s;

curl -X POST "https://$WEBUI_URL/api/v1/auths/signup" \
-H "Content-Type: application/json" \
-d '{
    "name": "Admin",
    "email": "'"$ADMIN_EMAIL"'",
    "password": "'"$ADMIN_PASSWORD"'",
    "profile_image_url": "data:image/png;base64,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"
}'


docker compose down;

sed -i "s/^ENABLE_SIGNUP=true/ENABLE_SIGNUP=false/" .env

docker compose up -d;
sleep 15s;